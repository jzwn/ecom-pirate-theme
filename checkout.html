<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackheart Emporium - Checkout</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&family=EB+Garamond:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'EB Garamond', serif;
            background-color: #0a0a1a;
            color: #f5ebd7;
            overflow-x: hidden;
        }

        h1, h2, h3, .heading-font {
            font-family: 'Uncial Antiqua', cursive;
        }

        #bg-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }

        .parchment-card {
            background: rgba(245, 235, 215, 0.85);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(218, 165, 32, 0.4);
            color: #4b3a26;
        }

        .pirate-input {
            background-color: rgba(181, 153, 119, 0.3); border: 1px solid #8B4513;
            border-radius: 8px; padding: 0.75rem; color: #4b3a26; width: 100%;
        }
        .pirate-input::placeholder { color: #6e5e4a; }
        
        .pirate-btn {
            background-color: #5C4033; color: #f5ebd7;
            transition: background-color 0.3s ease, transform 0.2s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
        }
        .pirate-btn:hover { background-color: #7a5a4a; transform: translateY(-2px); }
        .pirate-btn:disabled { background-color: #9d8a7e; cursor: not-allowed; }
        
        .quantity-btn {
            background-color: rgba(181, 153, 119, 0.5);
            transition: background-color 0.2s;
        }
        .quantity-btn:hover { background-color: rgba(181, 153, 119, 0.8); }
    </style>
</head>
<body class="min-h-screen">

    <canvas id="bg-canvas"></canvas>

    <header class="p-8 text-center">
        <a href="index.html" class="text-4xl text-white tracking-wider heading-font hover:text-amber-300 transition-colors">BLACKHEART</a>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
        <div id="checkout-container">
            <h1 class="text-center text-5xl font-bold text-white tracking-tight mb-12">Settle the Score</h1>
            
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8 lg:gap-12">

                <!-- Left Side: Shipping -->
                <div class="lg:col-span-3">
                    <div class="parchment-card p-6 sm:p-8 rounded-2xl">
                        <form id="order-form">
                            <h2 class="text-3xl font-bold mb-6">Captain's Details</h2>
                            <div class="grid grid-cols-1 gap-6">
                                <div>
                                    <label for="full-name" class="block text-sm font-medium">Full Pirate Name</label>
                                    <input type="text" id="full-name" required class="pirate-input mt-1 block w-full" placeholder="e.g., 'Calico' Jack Rackham">
                                </div>
                                <div>
                                    <label for="address" class="block text-sm font-medium">Secret Cove (Address)</label>
                                    <input type="text" id="address" required class="pirate-input mt-1 block w-full" placeholder="123 Ocean's Edge, Tortuga">
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                                    <div>
                                        <label for="city" class="block text-sm font-medium">Port (City)</label>
                                        <input type="text" id="city" required class="pirate-input mt-1 block w-full" placeholder="Poonjar">
                                    </div>
                                    <div>
                                        <label for="state" class="block text-sm font-medium">Territory (State)</label>
                                        <input type="text" id="state" required class="pirate-input mt-1 block w-full" placeholder="Kerala">
                                    </div>
                                    <div>
                                        <label for="zip" class="block text-sm font-medium">Postal Parrot Code</label>
                                        <input type="text" id="zip" required class="pirate-input mt-1 block w-full" placeholder="686581">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-8">
                                <button type="submit" id="place-order-btn" class="w-full pirate-btn font-bold py-4 px-4 rounded-lg text-lg">
                                    Complete the Plunder
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Right Side: Order Summary -->
                <div class="lg:col-span-2">
                    <div class="parchment-card p-6 sm:p-8 rounded-2xl">
                        <h2 class="text-3xl font-bold mb-6">Your Booty</h2>
                        
                        <div id="cart-items-container" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                            <!-- Cart items are injected here -->
                        </div>
                        
                        <div id="totals-container" class="border-t border-amber-900/20 mt-6 pt-6 space-y-2">
                            <div class="flex justify-between">
                                <span>Subtotal</span>
                                <span id="subtotal-price">$0.00</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Shipping by Brigantine</span>
                                <span id="shipping-price">$15.00</span>
                            </div>
                            <div class="flex justify-between font-bold text-lg">
                                <span>Total Doubloons</span>
                                <span id="total-price">$15.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="empty-cart-message" class="hidden text-center text-white py-24">
            <h1 class="text-4xl">The Hold is Empty!</h1>
            <p class="mt-4 text-xl">Ye have no booty in yer cart, matey.</p>
            <a href="index.html" class="mt-8 inline-block pirate-btn font-bold py-3 px-6 rounded-lg text-lg">Go Find Some Treasure</a>
        </div>
    </main>

    <footer class="text-center text-gray-400 py-12 px-4">
        <p>© 2025 BLACKHEART • All Rights Plundered • Sail Responsibly</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cartItemsContainer = document.getElementById('cart-items-container');
            const subtotalEl = document.getElementById('subtotal-price');
            const totalEl = document.getElementById('total-price');
            const shippingEl = document.getElementById('shipping-price');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const checkoutContainer = document.getElementById('checkout-container');
            const orderForm = document.getElementById('order-form');
            const placeOrderBtn = document.getElementById('place-order-btn');

            const SHIPPING_COST = 15.00;
            let cart = JSON.parse(localStorage.getItem('shoppingCart')) || [];

            function updateCart(updatedCart) {
                cart = updatedCart;
                localStorage.setItem('shoppingCart', JSON.stringify(cart));
                renderCart();
            }

            function renderCart() {
                if (cart.length === 0) {
                    emptyCartMessage.classList.remove('hidden');
                    checkoutContainer.classList.add('hidden');
                    return;
                }

                emptyCartMessage.classList.add('hidden');
                checkoutContainer.classList.remove('hidden');
                cartItemsContainer.innerHTML = '';

                let subtotal = 0;

                cart.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex items-center justify-between gap-4';
                    
                    const itemTotalPrice = item.price * item.quantity;
                    subtotal += itemTotalPrice;

                    itemElement.innerHTML = `
                        <div class="flex items-center gap-4">
                            <img src="${item.image}" alt="${item.name}" class="w-20 h-20 rounded-lg object-cover border-2 border-amber-900/30">
                            <div>
                                <p class="font-semibold">${item.name}</p>
                                <div class="flex items-center gap-2 mt-1">
                                    <button class="quantity-btn rounded-full w-6 h-6" data-index="${index}" data-action="decrease">-</button>
                                    <span>${item.quantity}</span>
                                    <button class="quantity-btn rounded-full w-6 h-6" data-index="${index}" data-action="increase">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-semibold">$${itemTotalPrice.toFixed(2)}</p>
                            <button class="text-sm text-red-800 hover:underline" data-index="${index}" data-action="remove">Remove</button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemElement);
                });

                subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
                shippingEl.textContent = `$${SHIPPING_COST.toFixed(2)}`;
                totalEl.textContent = `$${(subtotal + SHIPPING_COST).toFixed(2)}`;
            }

            cartItemsContainer.addEventListener('click', (e) => {
                const target = e.target;
                const action = target.dataset.action;
                const index = parseInt(target.dataset.index);

                if (!action) return;

                let newCart = [...cart];

                if (action === 'increase') {
                    newCart[index].quantity++;
                } else if (action === 'decrease') {
                    newCart[index].quantity--;
                    if (newCart[index].quantity === 0) {
                        newCart.splice(index, 1);
                    }
                } else if (action === 'remove') {
                    newCart.splice(index, 1);
                }

                updateCart(newCart);
            });

            orderForm.addEventListener('submit', (e) => {
                e.preventDefault();
                placeOrderBtn.disabled = true;
                placeOrderBtn.textContent = 'Securing the Booty...';
                
                setTimeout(() => {
                    alert('Order Placed! Your treasure is on its way to your secret cove.');
                    localStorage.removeItem('shoppingCart');
                    window.location.href = 'index.html';
                }, 2000);
            });
            
            renderCart();
        });

        // --- ANIMATED BACKGROUND SCRIPT ---
        window.onload = function() {
            const canvas = document.getElementById('bg-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);

            const particleCount = 2500;
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);
            const colorChoices = [new THREE.Color(0xffe58a), new THREE.Color(0x87ceeb), new THREE.Color(0xffffff)];

            for (let i = 0; i < particleCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 25;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 25;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 25;
                const color = colorChoices[Math.floor(Math.random() * colorChoices.length)];
                colors[i*3] = color.r; colors[i*3+1] = color.g; colors[i*3+2] = color.b;
            }

            const particles = new THREE.BufferGeometry();
            particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            particles.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            const particleMaterial = new THREE.PointsMaterial({ size: 0.03, vertexColors: true, transparent: true, opacity: 0.6 });
            const particleSystem = new THREE.Points(particles, particleMaterial);
            scene.add(particleSystem);
            camera.position.z = 7;

            const mouse = new THREE.Vector2();
            document.addEventListener('mousemove', (event) => {
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            });
            
            function animate() {
                requestAnimationFrame(animate);
                particleSystem.rotation.y += 0.0001;
                camera.position.x += (mouse.x * 0.2 - camera.position.x) * 0.02;
                camera.position.y += (mouse.y * 0.2 - camera.position.y) * 0.02;
                camera.lookAt(scene.position);
                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        };
    </script>
</body>
</html>

